#!/usr/bin/env node

var ArgumentParser = require('argparse').ArgumentParser
var term = require('terminal-kit').terminal
var kodikeys = require('..')
var package_json = require('../package.json')

// Command line options
var cli = new ArgumentParser({
  prog:     'kodikeys',
  add_help:  true,
  description: package_json.description,
})

cli.add_argument('host', {
  help:   'The Kodi host to connect to',
  default: 'localhost',
  nargs: '?'
})

cli.add_argument('-v', '--version', {
  action: 'version',
  version: package_json.version,
})


cli.add_argument('-p', '--port', {
  help:   'The EventServer port (default: 9777)',
  default: '9777',
})

cli.add_argument('--rpc-port', {
  help:    'The JSON-RPC port (default: 9090)',
  default: '9090'
})

cli.add_argument('--debug', {
  help: 'Shortcut for --log-level debug',
  dest: 'log_level',
  const: 'debug',
  action: 'store_const',
  default: 'warn'
})

cli.add_argument('--log-level', {
  default: 'warn',
  choices: ['error', 'warn', 'info', 'debug']
})

var opts = cli.parse_args()

// run the command
kodikeys.start(opts)
  .then( () => {
    console.log('Bye')
    term.processExit(0)
  })
  .catch( (msg, errors) => {
    term.processExit(1)
  })
